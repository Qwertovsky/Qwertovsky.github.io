<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta content="Qwertovsky" name="author">
  <link href="mailto:valery@qwertovsky.com" rel="author">
  <meta content="Qwertovsky, Qwertoblog, Квертовский" name="keywords">
  <meta content="Qwertovsky blog" name="description">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="/blog/favicon.svg">
  <title>Creating blog with Vue.js | QwertoBlog</title>
  
    <link href="/blog/css/app.f0de77ac.css" rel="stylesheet">
  
</head>

<body>
  <div id="app"><div id="pageHeader"><a href="/blog/" class="qm_brand router-link-active">QwertoBlog</a><div></div><a href="/blog/tag" class="qm_nav_link tags_link" tabindex="0">Tags</a><a tabindex="0" href="//qwertovsky.com" class="qm_nav_link site_link">Site</a></div><section id="centerPart"><div class="post"><div class="post_title"><span>Creating blog with Vue.js</span></div><div class="post_meta"> 2020-01-20 <span><span> | <a href="/blog/tag/vue.js" class="">vue.js</a></span><span> | <a href="/blog/tag/js" class="">js</a></span><span> | <a href="/blog/tag/frontend" class="">frontend</a></span></span></div><div class="post_content"><div><p>Earlier I tried to build blog with VuePress (<a href="/blog/posts/00022_creating_blog_with_vuepress.md" class="" target="_blank">link</a>). And I did not like it.
In this post I am trying to create static files for blog with <a href="https://vuejs.org">Vue.js</a> and <a href="https://github.com/chrisvfritz/prerender-spa-plugin">prerender-spa-plugin</a>.</p> <h1>Setup</h1> <pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> blog
<span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli
vue create <span class="token builtin class-name">.</span>
<span class="token function">npm</span> <span class="token function">install</span> -D cache-loader
<span class="token function">npm</span> <span class="token function">install</span> -D prerender-spa-plugin
<span class="token function">mkdir</span> posts
</code></pre><pre class="language-properties has_file_name"><span class="file_name">./.env</span><code class="language-properties"><span class="token attr-name">VUE_APP_BASE</span><span class="token punctuation">=</span><span class="token attr-value">/</span>
<span class="token attr-name">VUE_APP_POSTS_DIR</span><span class="token punctuation">=</span><span class="token attr-value">./posts/</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token keyword">const</span> <span class="token constant">POSTS_DIR</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_POSTS_DIR</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
      alias<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'PostsDir'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">POSTS_DIR</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Directory <code>./posts</code> is for blog articles. There are my markdown and html files.<br>
How can vue.js application get information from these files? I found <a href="https://github.com/hmsk/frontmatter-markdown-loader">frontmatter-markdown-loader</a>. This webpack loader transforms markdown file to object with frontmatter atributes and a vue component. So I can import attributes and a component from <code>md</code> file and use them in my vue components.</p> <pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> fm <span class="token keyword">from</span> <span class="token string">"post.md"</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span>
      PostComponent<span class="token operator">:</span> fm<span class="token punctuation">.</span>vue<span class="token punctuation">.</span>component
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">fm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fm<span class="token punctuation">.</span>attributes<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><p>For html files I can use <code>html-loader</code>.</p> <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>html<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> post <span class="token keyword">from</span> <span class="token string">"post.html"</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        content<span class="token operator">:</span> html
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>But html will not contain attributes. And <code>frontmatter-markdown-loader</code> does not return <code>excerpt</code> from post. With excerpt I can use the first part of a post that is before tag <code>&lt;!-- more --&gt;</code> as description for my blog index page. So I need a custom loader.</p> <h1>Loader</h1> <p>I use <a href="https://github.com/jonschlinkert/gray-matter">gray-matter</a> to get frontmatter attributes, excerpt, and full content. Then I apply <a href="https://github.com/markdown-it/markdown-it">markdown-it</a> to content and excerpt from markdown files. I skip this step for html files. I should escape html for code blocks that come from markdown. I assume html files are valid.<br>
I wrap html with one tag, because this html is used as a template for vue component.<br>
File name is used for path in router. So in the loader I add new attribute <code>slug</code>. Slug is like id for post. It is unique as well as file name is.</p> <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -D gray-matter
<span class="token function">npm</span> <span class="token function">install</span> -D markdown-it
<span class="token function">npm</span> <span class="token function">install</span> -D escape-html
<span class="token function">npm</span> <span class="token function">install</span> -D vue-template-compiler
</code></pre><pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">const</span> grayMatter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"gray-matter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> markdownIt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"markdown-it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> escapeHtml <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"escape-html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">wrap</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">"text"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  code <span class="token operator">=</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;pre v-pre class="language-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;&lt;code&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">oneRootElement</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>html<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> markdown <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  highlight<span class="token operator">:</span> wrap
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fmData <span class="token operator">=</span> <span class="token function">grayMatter</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span> excerpt_separator<span class="token operator">:</span> <span class="token string">"&lt;!-- more --&gt;"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> slug <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>slug <span class="token operator">=</span> slug<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".md"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmData<span class="token punctuation">.</span>content <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>description<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  fmData<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token function">oneRootElement</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> <span class="token function">oneRootElement</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>fmData<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
      rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span> <span class="token operator">+</span> <span class="token string">".+\.(md|html)$"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"post_loader.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>I use loader only for posts folder. <code>"\.(md|html)$"</code> will break main template <code>public/index.html</code>.</p> <h1>Show post</h1> <p>Now I can import all posts and create the blog index page. To do so I need to create file <code>index.js</code> in the posts dir and export all files one by one.</p> <pre class="language-js has_file_name"><span class="file_name">./posts/index.js</span><code class="language-js"><span class="token keyword">import</span> FirstPost <span class="token keyword">from</span> <span class="token string">"./00001_first_post.html"</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token keyword">import</span> VertxTestPost <span class="token keyword">from</span> <span class="token string">"./00021_vertx_test.md"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VuePressPost <span class="token keyword">from</span> <span class="token string">"./00022_creating_blog_with_vuepress.md"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> BlogVueJsPost <span class="token keyword">from</span> <span class="token string">"./00023_creating_blog_with_vue.js.md"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token punctuation">[</span>
  FirstPost<span class="token punctuation">,</span>
  <span class="token comment">//...</span>
  VertxTestPost<span class="token punctuation">,</span>
  VuePressPost<span class="token punctuation">,</span>
  BlogVueJsPost
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> posts<span class="token punctuation">;</span>
</code></pre><p>So my post is object like this:</p> <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// frontmater attributes</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Crating blog with Vue.js"</span><span class="token punctuation">,</span>
    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token string">"2020-01-20"</span><span class="token punctuation">,</span>
    <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vue.js"</span><span class="token punctuation">,</span> <span class="token string">"frontend"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"slug"</span><span class="token operator">:</span> <span class="token string">"00023_creating_blog_with_vue.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"excerpt"</span><span class="token operator">:</span> <span class="token string">"&lt;div&gt;...&lt;/div&gt;"</span><span class="token punctuation">,</span> <span class="token comment">// html content above &lt;!-- more --&gt;</span>
  <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"&lt;div&gt;...&lt;/div&gt;"</span> <span class="token comment">// full post</span>
<span class="token punctuation">}</span>
</code></pre><p>For pagination I added new property to environment.</p> <pre class="language-properties has_file_name"><span class="file_name">./.env</span><code class="language-properties"><span class="token attr-name">VUE_APP_POSTS_PER_PAGE</span><span class="token punctuation">=</span><span class="token attr-value">20</span>
</code></pre><p>Component <code>Index.vue</code> is used for main index and for index on each tag page.</p> <pre class="language-js has_file_name"><span class="file_name">./src/router/index.js</span><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">import</span> Index <span class="token keyword">from</span> <span class="token string">'@/components/Index.vue'</span>
<span class="token keyword">import</span> Tags <span class="token keyword">from</span> <span class="token string">'@/components/Tags.vue'</span>
<span class="token keyword">import</span> Post <span class="token keyword">from</span> <span class="token string">'@/components/Post.vue'</span>

<span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">"@/views/About.vue"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> posts <span class="token keyword">from</span> <span class="token string">"PostsDir"</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">"/about"</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> About
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Index
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/page/:index'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Index
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/tag'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Tags<span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">"Tags"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/tag/:tag'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Index
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/tag/:tag/page/:index'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Index
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/posts/:slug'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Post<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">"history"</span><span class="token punctuation">,</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token string">"QwertoBlog"</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">=</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token string">" | "</span> <span class="token operator">+</span> title<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"slug"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slug <span class="token operator">=</span> to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"slug"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> post <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>data<span class="token punctuation">.</span>slug <span class="token operator">==</span> slug<span class="token punctuation">)</span>
    title <span class="token operator">=</span> post<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token string">" | "</span> <span class="token operator">+</span> title<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"index"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"index"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    title <span class="token operator">=</span> <span class="token string">"Page "</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">" | "</span> <span class="token operator">+</span> title<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"tag"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tag <span class="token operator">=</span> to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"tag"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    title <span class="token operator">=</span> <span class="token string">"Tag "</span> <span class="token operator">+</span> tag <span class="token operator">+</span> <span class="token string">" | "</span> <span class="token operator">+</span> title<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre><pre class="language-html has_file_name"><span class="file_name">./src/components/Index.vue</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post in posts<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post.data.slug<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Post</span> <span class="token attr-name">:post-data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">:more</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagination<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagination_older<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hasPrev<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prevUrl<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Old<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>« Old<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagination_home<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagination_newer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hasNext<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nextUrl<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>New<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>New »<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> allPosts <span class="token keyword">from</span> <span class="token string">"PostsDir"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Post <span class="token keyword">from</span> <span class="token string">"@/components/Post.vue"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">POSTS_PER_PAGE</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_POSTS_PER_PAGE</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">hasPrev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxIndex <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">prevUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxIndex <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/tag/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/page/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/page/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">nextUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/tag/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/tag/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/page/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/page/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">postsByTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> posts <span class="token operator">=</span> allPosts
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">post</span> <span class="token operator">=&gt;</span> 
        <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> post<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tags <span class="token operator">&amp;&amp;</span> post<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>data<span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> posts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"tag"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"index"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxIndex<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> index<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">maxIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>postsByTag<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token constant">POSTS_PER_PAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> posts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>postsByTag<span class="token punctuation">;</span>
      <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxIndex<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      posts <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> posts<span class="token punctuation">.</span>length <span class="token operator">-</span> index <span class="token operator">*</span> <span class="token constant">POSTS_PER_PAGE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        posts<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">POSTS_PER_PAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> posts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    Post
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-html has_file_name"><span class="file_name">./src/components/Post.vue</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post_titile<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>outbound<span class="token punctuation">"</span></span> <span class="token attr-name">:href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postUrl<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        {{ title }}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OutLink</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postUrl<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postUrl<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post_meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      {{fm.date}}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MetaTags</span> <span class="token attr-name">:tags</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fm.tags<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post_content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> posts <span class="token keyword">from</span> <span class="token string">"PostsDir"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MetaTags <span class="token keyword">from</span> <span class="token string">"@/components/MetaTags.vue"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OutLink <span class="token keyword">from</span> <span class="token string">"@/components/OutLink.vue"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    MetaTags<span class="token punctuation">,</span>
    OutLink
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    postData<span class="token operator">:</span> Object<span class="token punctuation">,</span>
    more<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// true - show all post, false - only excerpt</span>
      type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> post <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>postData<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// postData exists on index page, it is null if post is opened by direct link</span>
      <span class="token keyword">const</span> slug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"slug"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      post <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>data<span class="token punctuation">.</span>slug <span class="token operator">==</span> slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      post
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fm <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fm<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>more <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post<span class="token punctuation">.</span>content <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post<span class="token punctuation">.</span>excerpt
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">postUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> postUrl <span class="token operator">=</span> <span class="token string">"/posts/"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fm<span class="token punctuation">.</span>slug<span class="token punctuation">;</span>
      <span class="token keyword">const</span> slug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"slug"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>slug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        postUrl <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fm<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        postUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fm<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> postUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">outbound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fm<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>You can see that I use a dynamic component to show post content. And this component is just html template. Runtime compilation must be enabled for it. Otherwise we get error:</p> <blockquote><p>[Vue warn]: You are using the runtime-only build of Vue where the template compiler is not available. Either pre-compile the templates into render functions, or use the compiler-included build.</p></blockquote> <p>So I need to turn it on in vue.js</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  runtimeCompiler<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><h1>Tags</h1> <p>The component to show tags on post.</p> <pre class="language-html has_file_name"><span class="file_name">./src/components/MetaTags.vue</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t of tags<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      | <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tagUrl(t)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{t}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    tags<span class="token operator">:</span> Array
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">tagUrl</span><span class="token punctuation">(</span><span class="token parameter">tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">"/tag/"</span> <span class="token operator">+</span> tag<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>The component to show tags list.</p> <pre class="language-html has_file_name"><span class="file_name">./src/components/Tags.vue</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>default-layout<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tag in tags<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tag.name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>page-link<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tag.path<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ tag.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> posts <span class="token keyword">from</span> <span class="token string">"PostsDir"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> tags <span class="token operator">=</span> posts
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tags <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tagsP<span class="token punctuation">,</span> tagsC</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> tagsP<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>tagsC<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> t<span class="token punctuation">,</span>
            path<span class="token operator">:</span> <span class="token string">"/tag/"</span> <span class="token operator">+</span> t
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> tags<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><h1>Prerender SPA plugin</h1> <p>Now I can build static files from my SPA. To do so I should tell plugin all routes that I want to have static. For blog it means all routes.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> PrerenderSPAPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"prerender-spa-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> grayMatter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"gray-matter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">POSTS_DIR</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_POSTS_DIR</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">POSTS_PER_PAGE</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_POSTS_PER_PAGE</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">BLOG_BASE</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createPagesForPosts</span> <span class="token punctuation">(</span><span class="token parameter">posts<span class="token punctuation">,</span> base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> maxIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>posts<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token constant">POSTS_PER_PAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base <span class="token operator">+</span> <span class="token string">"page/"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> pages<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> allPosts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>withFileTypes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> file<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token regex">/^.+\.(md|html)$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fmData <span class="token operator">=</span> grayMatter<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span> <span class="token operator">+</span> file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    allPosts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      <span class="token keyword">const</span> slug <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"/posts/"</span> <span class="token operator">+</span> slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token function">createPagesForPosts</span><span class="token punctuation">(</span>allPosts<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

tags <span class="token operator">=</span> tags<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
tags <span class="token operator">=</span> tags<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> t<span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token string">"/tag/"</span> <span class="token operator">+</span> t
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"/tag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tags<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tagPosts <span class="token operator">=</span> allPosts<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>tags <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token function">createPagesForPosts</span><span class="token punctuation">(</span>tagPosts<span class="token punctuation">,</span> t<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> blogConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> prerenderPlugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        staticDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        routes<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      blogConfig<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token punctuation">[</span>prerenderPlugin<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> blogConfig<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>Now I can run a build and all pages will be in <code>./dist</code> folder.</p> <p>Prerender plugin waits when all scripts and styles will be loaded. And 500ms in addition. When script for vue.js app are loaded this code will be executed synchronously. Browser shows that page is been loading. And the prerender waits too. And <code>window.onload</code> event will be trigered when all vue components are mounted.</p> <p>I can brake this behaviour if I add async router guard.</p> <pre class="language-js"><code class="language-js"><span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><p>The page will be loaded at first and then vue components will be mounted. So I can't use prerender with async code without additional configuration. The plugin has options: to wait custom event on document, or wait any time.</p> <h1>Remove scripts from build</h1> <p>I wrote about VuePress that scripts remain on a page after build. Now I have this problem again.<br>
Why is it a problem? As I said before, a window loading is complete when all components are mounted. When all content exists on page I don't need to start the SPA processing. More time is the problem.</p> <p>I will remove scripts on <code>load</code> event.</p> <pre class="language-js has_file_name"><span class="file_name">./main.js</span><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"spaScripts"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-html has_file_name"><span class="file_name">./src/public/index.html</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- ... --&gt;</span>
  &lt;% for (key in htmlWebpackPlugin.files.css) { %&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%= htmlWebpackPlugin.files.css[key] %&gt;<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  &lt;% } %&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- ... --&gt;</span>
  <span class="token comment">&lt;!-- built files will not be auto injected --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spaScripts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- injecting explicitly --&gt;</span>
    &lt;% for (var chunk in htmlWebpackPlugin.files.chunks) { %&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%= htmlWebpackPlugin.files.chunks[chunk].entry %&gt;<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
      &lt;% } %&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token comment">// ...</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config
      <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> options <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>minify <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>inject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> args<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><p>I edited HtmlWebpackPlugin. I turned off the auto-injecting scripts to the template body. I defined the placement in my template for created scripts. And I can remove just this scripts and leave others. I found <a href="https://github.com/jaketrent/html-webpack-template/blob/master/index.ejs">Default template</a> in <code>html-webpack-plugin</code> docs. You can keep other blocks.<br>
With disabled minification it is easier to check result.</p> <p>Condition <code>process.env.NODE_ENV === 'production'</code> will work for blog when all pages must be static. Otherwise I should check another flag.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token keyword">const</span> Renderer <span class="token operator">=</span> PrerenderSPAPlugin<span class="token punctuation">.</span>PuppeteerRenderer<span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token keyword">const</span> prerenderPlugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  renderer<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Renderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    injectProperty<span class="token operator">:</span> <span class="token string">'__PRERENDER_INJECTED'</span><span class="token punctuation">,</span>
    inject<span class="token operator">:</span> <span class="token punctuation">{</span>
      prerendered<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
</code></pre><p>Renderer will inject property to <code>window</code> on processed pages.</p> <pre class="language-js has_file_name"><span class="file_name">./main.js</span><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__PRERENDER_INJECTED <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>__PRERENDER_INJECTED<span class="token punctuation">.</span>prerendered<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"spaScripts"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h1>Change base path</h1> <p>I can place files to <code>https://blog.example.com/</code> and links will work. What if I want to serve blog from <code>https://example.com/blog/</code>?<br>
I can change the router base and change routes for the plugin.</p> <pre class="language-properties has_file_name"><span class="file_name">./.env</span><code class="language-properties"><span class="token attr-name">VUE_APP_BASE</span><span class="token punctuation">=</span><span class="token attr-value">/blog/</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">const</span> <span class="token constant">BLOG_BASE</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        staticDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        routes<span class="token operator">:</span> routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token constant">BLOG_BASE</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"//"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  publicPath<span class="token operator">:</span> <span class="token constant">BLOG_BASE</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./src/router.index.js</span><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">"history"</span><span class="token punctuation">,</span>
  base<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">,</span> <span class="token comment">// == publicPath from vue.config.js</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre><p>But after a build the pages will be empty. Because a request come to <code>/blog/index.html</code> but the plugin serve <code>index.html</code> from <code>/</code>. There is the problem (https://github.com/chrisvfritz/prerender-spa-plugin/issues/344).</p> <p>To solve that I added <code>server</code> property to the plugin.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  staticDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token constant">BLOG_BASE</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"//"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  server<span class="token operator">:</span> <span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">"/blog/"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">"http://localhost:3000"</span><span class="token punctuation">,</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">"^/blog/"</span><span class="token operator">:</span> <span class="token string">"/"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
</code></pre><p>The base is hardcoded. I can rewrite it:</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token keyword">const</span> <span class="token constant">BLOG_BASE</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PRERENDER_SERVER</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  proxy<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token constant">PRERENDER_SERVER</span><span class="token punctuation">.</span>proxy<span class="token punctuation">[</span><span class="token constant">BLOG_BASE</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PRERENDER_SERVER</span><span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token constant">PRERENDER_SERVER</span><span class="token punctuation">.</span>proxy<span class="token punctuation">[</span><span class="token constant">BLOG_BASE</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pathRewrite<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BLOG_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  staticDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token constant">BLOG_BASE</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"//"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  server<span class="token operator">:</span> <span class="token constant">PRERENDER_SERVER</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
</code></pre><p>Now <code>./dist</code> folder contains <code>BLOG_BASE</code> folder with posts. But all other assets and public files are in <code>./dist</code>. I want to move them under <code>/dist/blog</code>.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token keyword">const</span> <span class="token constant">DIST_DIR</span> <span class="token operator">=</span> <span class="token string">"dist"</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
  <span class="token keyword">const</span> prerenderPlugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    staticDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">DIST_DIR</span><span class="token punctuation">,</span> <span class="token constant">BLOG_BASE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    outputDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">DIST_DIR</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
outputDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">DIST_DIR</span><span class="token punctuation">,</span> <span class="token constant">BLOG_BASE</span><span class="token punctuation">)</span>
</code></pre><h1>Images</h1> <p>I may include the image in my post</p> <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>PostsDir/00008/window.png<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><p>But this does not work.</p> <p>I can move the image to <code>./src/assets</code></p> <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@/assets/window.png<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><p>This does not work too.</p> <p><code>Vue Loader</code> does this processing when compiles a component. Loader transforms a url to webpack requests. Then <code>file-loader</code> moves images and adds hashes. New url will be placed to <code>img:src</code>.<br>
My template does not go through <code>Vue Loader</code>. Hence urls stay as-is.</p> <p>I can solve this easy. I will move all images under <code>/public</code> and be done with it. The image <code>/public/window.png</code> will be available as <code>src="/window.png"</code>.<br>
But I don't take easy road. I want keep images under <code>PostsDir</code> next to posts' files. To do so I should change my loader and compile templates to components.</p> <pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">const</span> vueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compilerUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/component-compiler-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compileTemplate <span class="token operator">=</span> compilerUtils<span class="token punctuation">.</span>compileTemplate<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> compileOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    source<span class="token operator">:</span> html<span class="token punctuation">,</span>
    compiler<span class="token operator">:</span> vueTemplateCompiler<span class="token punctuation">,</span>
    compilerOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      outputSourceRange<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    transformAssetUrls<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    isProduction<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> contentCode <span class="token operator">=</span> <span class="token function">compileTemplate</span><span class="token punctuation">(</span>compileOptions<span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  let </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Component;
  {
    const extractVueFunctions = () =&gt; {
      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      return { render, staticRenderFns };
    }
    const vueFunctions = extractVueFunctions();
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Component = {
      data: function () {
        return {
          templateRender: null
        }
      },
      render: function (createElement) {
        return this.templateRender ? this.templateRender(createElement) : createElement("div", "Rendering");
      },
      created: function () {
        this.templateRender = vueFunctions.render;
        this.$options.staticRenderFns = vueFunctions.staticRenderFns;
      }
    }
  }
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> contentCode <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">,</span> fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> excerptCode <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"excerpt"</span><span class="token punctuation">,</span> fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>excerptCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    export default {
      data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,
      excerptComponent,
      contentComponent
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./src/components/Post.vue</span><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>more <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post<span class="token punctuation">.</span>contentComponent <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post<span class="token punctuation">.</span>excerptComponent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>I don't need the runtime compiler anymore.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// runtimeCompiler: true,</span>
<span class="token punctuation">}</span>
</code></pre><p>But my alias <code>PostsDir</code> does not work. Because the compiler transforms url that starts with <code>.</code>, <code>~</code>, or <code>@</code>. <code>@</code> is the <code>vue-cli</code> alias to <code>./src</code>. So I can use <code>@</code> as prefix for my alias. I changed <code>PostsDir</code> to <code>@PostsDir</code> everywhere. And images were processed. They all were build to <code>./dist/img/</code>.</p> <p>I don't like that place for posts' images. I want to see them next to posts. It means I have to change <code>file-loader</code> options.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">const</span> <span class="token constant">POSTS_DIR_RE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR_RE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR_RE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'postImages'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.(png|jpe?g|gif|webp|svg)(\?.*)?$/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>include<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR_RE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'file-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'file-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'[path][name].[hash:8].[ext]'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><h1>Use Vue Loader</h1> <p>I can remove compilation from the loader and chain this operation to <code>vue-loader</code>.</p> <pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">const</span> grayMatter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"gray-matter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> markdownIt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"markdown-it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> escapeHtml <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"escape-html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">wrap</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">"text"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  code <span class="token operator">=</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;pre v-pre class="language-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;&lt;code&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> markdown <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  highlight<span class="token operator">:</span> wrap
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fmData <span class="token operator">=</span> <span class="token function">grayMatter</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span> excerpt_separator<span class="token operator">:</span> <span class="token string">"&lt;!-- more --&gt;"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> slug <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>slug <span class="token operator">=</span> slug<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".md"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmData<span class="token punctuation">.</span>content <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>description<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default 
    &lt;template&gt;
      &lt;div&gt;
        &lt;div v-if="!more"&gt;
          </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fmData<span class="token punctuation">.</span>excerpt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        &lt;/div&gt;
        &lt;div v-if="more"&gt;
          </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fmData<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/template&gt;

    &lt;script&gt;
    export default {
      fmData: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,
      props: {
        more: {
          default: false
        }
      }
    }
    &lt;/script&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
      rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span> <span class="token operator">+</span> <span class="token string">".+\.(md|html)$"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"post_loader.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">const</span> <span class="token constant">POSTS_DIR_RE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'eslint'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR_RE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-html has_file_name"><span class="file_name">./src/components/Post.vue</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>contentProps<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span>
<span class="token attr-name">&lt;script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">contentProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>more<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>more<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>Then I have to find all occurrences of <code>post.data</code> and change it to <code>post.fmData</code>.</p> <p>Now while I am editing my post, it will hot-update in browser.</p> <h1>Highlight code</h1> <p>I use <a href="https://prismjs.com">Prism</a> to highlight code blocks in my posts.</p> <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -D prismjs
</code></pre><p>I can use it in the loader. <code>markdown-it</code> has the option to set a function that will highlight code.</p> <pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">const</span> prism <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"prismjs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prismLoadLanguages <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"prismjs/components/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">prismLoadLanguages</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">,</span> <span class="token string">"css"</span><span class="token punctuation">,</span> <span class="token string">"md"</span><span class="token punctuation">,</span> <span class="token string">"js"</span><span class="token punctuation">,</span> <span class="token string">"java"</span><span class="token punctuation">,</span> <span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"rust"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">highlight</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">"text"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> code<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>prism<span class="token punctuation">.</span>languages<span class="token punctuation">[</span>lang<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    code <span class="token operator">=</span> prism<span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> prism<span class="token punctuation">.</span>languages<span class="token punctuation">[</span>lang<span class="token punctuation">]</span><span class="token punctuation">,</span> lang<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    code <span class="token operator">=</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;pre v-pre class="language-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;&lt;code&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> markdown <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  highlight<span class="token operator">:</span> highlight
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>I call <code>escapeHtml</code> just for code that is not processed by <code>Prism</code>. <code>Prism</code> do it for other code.</p> <p>But what about html files? I have to find code blocks and edit html tree. But NodeJS does not have DOM. There are packages that can parse html and play with tree. I recommend <code>jsdom</code>. It allows to highligh whole document.<br>
Other libs like <code>cheerio</code> give you pseudo <a href="https://developer.mozilla.org/en-US/docs/Web/API/element">Elements</a>. There are a few methods from api. But it is not enough and <code>Prism</code> can not work with this elements. Anyway, your code inside <code>&lt;code&gt;</code> must be escaped. This libs try to fix all, which looks like html. So you can't run <code>Prism</code> with <code>Element</code> and can't run it with this escaped code like I did with markdown.</p> <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -D jsdom
</code></pre><pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">const</span> jsdom <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jsdom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">JSDOM</span> <span class="token punctuation">}</span> <span class="token operator">=</span> jsdom<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">highlightHtml</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> document <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSDOM</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">;</span>
  prism<span class="token punctuation">.</span><span class="token function">highlightAllUnder</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".md"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmData<span class="token punctuation">.</span>content <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmData<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token function">highlightHtml</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> <span class="token function">highlightHtml</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><p>An escaping code by hands is pain. It is the reason to use markdown for posts about programming and don't use Blogger.</p> <h3>Move Prism from the loader</h3> <p>There is another way to use <code>Prism</code>. I will call <code>Prism</code> after page has been ready and components have been mounted. And remove the highlighting from the loader. In the loader I will just escape html for markdown.</p> <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -D @vue/cli-plugin-babel babel-plugin-prismjs
</code></pre><pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">function</span> <span class="token function">wrap</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> lang <span class="token operator">=</span> <span class="token string">"text"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  code <span class="token operator">=</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;pre v-pre class="language-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;&lt;code&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> markdown <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  highlight<span class="token operator">:</span> wrap
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class="language-vue has_file_name"><span class="file_name">./src/components/Post.vue</span><code class="language-vue"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> Prism <span class="token keyword">from</span> <span class="token string">"prismjs"</span><span class="token punctuation">;</span>
Prism<span class="token punctuation">.</span>manual <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Prism<span class="token punctuation">.</span><span class="token function">highlightAll</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./babel.config.js</span><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> 
    <span class="token punctuation">[</span>
      <span class="token punctuation">[</span><span class="token string">"prismjs"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token string">"languages"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"html"</span><span class="token punctuation">,</span>
            <span class="token string">"css"</span><span class="token punctuation">,</span>
            <span class="token string">"scss"</span><span class="token punctuation">,</span>
            <span class="token string">"md"</span><span class="token punctuation">,</span>
            <span class="token string">"js"</span><span class="token punctuation">,</span>
            <span class="token string">"java"</span><span class="token punctuation">,</span>
            <span class="token string">"bash"</span><span class="token punctuation">,</span>
            <span class="token string">"rust"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">,</span>
            <span class="token string">"json"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">"css"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token comment">// "theme": "tomorrow"</span>
          
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-css has_file_name"><span class="file_name">./src/styles/style.scss</span><code class="language-css">@import <span class="token string">'~prismjs/themes/prism-tomorrow.css'</span>
</code></pre><p>I import Prism styles to my main style file. But you can activate it with babel plugin.<br>
I use <code>$nextTick</code> because <code>Post</code> component has the child component, my post content. I should wait it to highlight it. And the prerender will wait when Prism finishes.<br>
Hot reload for code blocks may not work after Prism changes. Because Prism manipulates with DOM. May be it is a reason to revert back and use prism in the loader.</p> <h1>Out of memory</h1> <p>I added 100 posts like this. And Node.js crashed with error. It
means that this solution will not work in future. I think that problem is because</p> <pre class="language-js"><code class="language-js"><span class="token keyword">import</span> posts <span class="token keyword">from</span> <span class="token string">"@PostsDir"</span><span class="token punctuation">;</span>
</code></pre><p>I can't import all posts together. I will try dynamic import.</p> <h1>Post dynamic import</h1> <p>In router I added one path <code>/posts/:slug</code> with parameter <code>slug</code>. And <code>slug</code> is file name. My <code>slug</code> is file name without extension. But I can use full file name. So in <code>Post.vue</code> I can import just this file. <code>posts</code> is array of just frontmater. I use it to check that slug exist. This array I set to <code>process.env.VUE_APP_POSTS</code> in <code>vue.config.js</code>. Also I created <code>process.env.VUE_APP_TAGS</code>.</p> <pre class="language-js has_file_name"><span class="file_name">./router/index.js</span><code class="language-js"><span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_POSTS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">//...</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">"/posts/:slug"</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Post<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">"/404"</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">"NotFound"</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> NotFound<span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token string">'*'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"slug"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slug <span class="token operator">=</span> to<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"slug"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> post <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>slug <span class="token operator">==</span> slug<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">"NotFound"</span><span class="token punctuation">,</span> replace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./src/components/Index.vue</span><code class="language-js"><span class="token keyword">const</span> allPosts <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_POSTS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
</code></pre><pre class="language-html has_file_name"><span class="file_name">./src/components/Tags.vue</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_TAGS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-html has_file_name"><span class="file_name">./src/components/Post.vue</span><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_POSTS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> post <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>postData<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> slug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"slug"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      post <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>slug <span class="token operator">==</span> slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@PostsDir/"</span> <span class="token operator">+</span> post<span class="token punctuation">.</span>slug<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> p<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>component <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      post<span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">fm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>post<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">contentComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>component<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">createElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token string">"Rendering..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3>Renderer</h3> <p>Now I need to configure renderer to work with big amount of pages and wait dynamic content.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token comment">//...</span>
renderer<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Renderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  injectProperty<span class="token operator">:</span> <span class="token string">'__PRERENDER_INJECTED'</span><span class="token punctuation">,</span>
  inject<span class="token operator">:</span> <span class="token punctuation">{</span>
    prerendered<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  navigationOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    waitUntil<span class="token operator">:</span> <span class="token string">'load'</span><span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maxConcurrentRoutes<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//...</span>
</code></pre><p>Event <code>load</code> happens after code from dynamic chunk has been executed. I limit concurrent routes because chromium takes a lot of memory and crashes. If chromium works slow, timeout can be reached. So I disabled timeout.</p> <h3>Remove script chunks from static pages</h3> <p>Webpack generates chunks for dynamic posts. I should remove them.</p> <pre class="language-js has_file_name"><span class="file_name">.src/main.js</span><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__PRERENDER_INJECTED <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>__PRERENDER_INJECTED<span class="token punctuation">.</span>prerendered<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"spaScripts"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"chunk"</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3>Other files in @PostsDir</h3> <p>I keep other files next to posts (java, pdf, etc). With dynamic import in code I get warning:</p> <blockquote><p>warning  in ./posts/00001/Somefile.java <br>
Module parse failed: The keyword 'public' is reserved (2:0) <br>
You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders<br>
@ ./posts lazy ^./.*$ namespace object<br>
@ ./node_modules/cache-loader/dist/cjs.js??ref--12-0!./node_modules/babel-loader/lib!./node_modules/cache-loader/dist/cjs.js??ref--0-0!./node_modules/vue-loader/lib??vue-loader-options!./src/components/Post.vue?vue&amp;type=script&amp;lang=js&amp;<br>
@ ./src/components/Post.vue?vue&amp;type=script&amp;lang=js&amp;<br>
@ ./src/components/Post.vue<br>
@ ./src/router/index.js<br>
@ ./src/main.js<br>
@ multi (webpack)-dev-server/client?http://192.168.13.112:8080/sockjs-node (webpack)/hot/dev-server.js ./src/main.js</p></blockquote> <p>To get rid of the warning I added posts dir to <code>noParse</code>. And I excluded resources with <code>/</code> in <code>POSTS_DIR</code>.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
            test<span class="token operator">:</span> <span class="token regex">/\.(md|html)$/</span><span class="token punctuation">,</span>
            include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">POSTS_DIR</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span> <span class="token operator">+</span> <span class="token string">"[^\\/]+\\/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">//...</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">const</span> <span class="token constant">POST_IMAGES_RE</span> <span class="token operator">=</span> <span class="token regex">/\.(png|jpe?g|gif|webp|svg)$/</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> noParseDefault <span class="token operator">=</span> config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"noParse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"noParse"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> defaultResult <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> noParseDefault <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        defaultResult <span class="token operator">=</span> <span class="token function">noParseDefault</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        defaultResult <span class="token operator">=</span> noParseDefault<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> defaultResult
        <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span> <span class="token operator">+</span> <span class="token string">".+\/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token constant">POST_IMAGES_RE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Then I get another error at runtime.</p> <blockquote><p>SyntaxError: export declarations may only appear at top level of a module</p></blockquote> <p>So in the loader I changed <code>export default</code> by <code>module.exports =</code>.</p> <h3>Speed is low</h3> <p>Now I can build 100 posts. But it works slow. It takes 2 minutes to start <code>npm run serve</code>. I decided to throw away <code>vue-loader</code> and don't compile components. I returned back to images with hardcoded urls. After changes the build time decreased to 5 seconds. And I do the highlighting in the loader. It is fast enough.</p> <h1>Images again</h1> <p>I can resolve relative image urls with <code>html-loader</code> and <code>extract-loader</code>.</p> <pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">const</span> htmlLoader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"html-loader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> extractLoader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"extract-loader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  fmData<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token function">oneRootElement</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  fmData<span class="token punctuation">.</span>excerpt <span class="token operator">=</span> <span class="token function">oneRootElement</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> excerpt <span class="token operator">=</span> <span class="token function">htmlLoader</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token function">htmlLoader</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fmData<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> excerptPromise <span class="token operator">=</span> <span class="token function">extractLoader</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">async</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>excerpt <span class="token operator">=</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    excerpt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> contentPromise <span class="token operator">=</span> <span class="token function">extractLoader</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">async</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>content <span class="token operator">=</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>excerptPromise<span class="token punctuation">,</span> contentPromise<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>excerpt<span class="token punctuation">,</span> content<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>My images are placed in <code>@PostsDir</code>. So relative path <code>./00008/window.png</code> works in a post html. But <code>@PostsDir/00008/window.png</code> does not work. There is bug <a href="https://github.com/webpack-contrib/html-loader/issues/185">185</a>.  As recomended <code>~@PostsDir/00008/window.png</code> should work, but it doesn't.</p> <p>This workaround looks hacky. Calling another loader from loader is strange. I don't chain loaders in the webpack config because my loader returns two html strings: excerpt and whole content. I should split <code>excerpt</code> and <code>content</code>. I need two imports for one resource. I will use resource query.</p> <pre class="language-js has_file_name"><span class="file_name">./src/components/Post.vue</span><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">let</span> contentPromise<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>more<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  contentPromise <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@PostsDir/"</span> <span class="token operator">+</span> post<span class="token punctuation">.</span>slug <span class="token operator">+</span> <span class="token string">"?more=true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  contentPromise <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@PostsDir/"</span> <span class="token operator">+</span> post<span class="token punctuation">.</span>slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
contentPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> html<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> html<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./post_loader.js</span><code class="language-js"><span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"querystring"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceQuery<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> content<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span>more <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  content <span class="token operator">=</span> fmData<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  content <span class="token operator">=</span> fmData<span class="token punctuation">.</span>excerpt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//... markdown and html processing</span>
content <span class="token operator">=</span> <span class="token function">oneRootElement</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> content<span class="token punctuation">;</span>
</code></pre><pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js">rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.(md|html)$/</span><span class="token punctuation">,</span>
    include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">POSTS_DIR</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span> <span class="token operator">+</span> <span class="token string">"[^\\/]+\\/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"html-loader"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"post_loader.js"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><p>Now images works and <code>~@PostsDir/00008/window.png</code> works too. <code>extract-loader</code> is unnecessary.</p> <h1>Partial build</h1> <p>Remember that my pagination is when the oldest post is on page 1. And the page <code>/index.html</code> is not filled to the <code>POSTS_PER_PAGE</code>. Root page may has only one post. It means new post does not change content of all previous pages. Therefore, to add one new post I don't need to rerender all posts and pages again.</p> <p>I added two arguments for build script.</p> <pre class="language-bash"><code class="language-bash"><span class="token comment">#build post with number 00008</span>
<span class="token function">npm</span> run build -- --post-number<span class="token operator">=</span><span class="token number">8</span>

<span class="token comment">#build posts with date &gt;= 2020-01-01</span>
<span class="token function">npm</span> run build -- --post-date<span class="token operator">=</span><span class="token number">2020</span>-01-01
</code></pre><p>In <code>vue.config.js</code> I filter routes that show posts specified by parameters. And only this routes will be added to prerender plugin.</p> <pre class="language-js has_file_name"><span class="file_name">./vue.config.js</span><code class="language-js"><span class="token keyword">const</span> postNumberRe <span class="token operator">=</span> <span class="token regex">/^--post-number=(\d+)$/</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> postDateRe <span class="token operator">=</span> <span class="token regex">/^--post-date=([\d-]+)$/</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> postNumberArg <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> postNumberRe<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> postDateArg <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> postDateRe<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>postNumberArg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  postNumberArg <span class="token operator">=</span> postNumberArg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>postNumberRe<span class="token punctuation">,</span> <span class="token string">"$1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>postDateArg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  postDateArg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>postDateArg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>postDateRe<span class="token punctuation">,</span> <span class="token string">"$1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createPagesForPosts</span> <span class="token punctuation">(</span><span class="token parameter">posts<span class="token punctuation">,</span> base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> maxIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>posts<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token constant">POSTS_PER_PAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base <span class="token operator">+</span> <span class="token string">"page/"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>postDateArg <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>postNumberArg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base <span class="token operator">+</span> <span class="token string">"page/"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    posts <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> maxIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> pagePosts <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> posts<span class="token punctuation">.</span>length <span class="token operator">-</span> i <span class="token operator">*</span> <span class="token constant">POSTS_PER_PAGE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          posts<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">POSTS_PER_PAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> existsonpage <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>postNumberArg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        existsonpage <span class="token operator">=</span> pagePosts<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>slug<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>postNumberArg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>postDateArg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        existsonpage <span class="token operator">=</span> pagePosts<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> postDateArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>existsonpage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> maxIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base <span class="token operator">+</span> <span class="token string">"page/"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>withFileTypes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> file<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token regex">/^.+\.(md|html)$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fmData <span class="token operator">=</span> grayMatter<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">POSTS_DIR</span> <span class="token operator">+</span> fileName<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>slug <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
    allPosts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> slug <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
    <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>postNumberArg <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>postDateArg
      <span class="token operator">||</span> postNumberArg <span class="token operator">&amp;&amp;</span> slug<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>postNumberArg<span class="token punctuation">)</span>
      <span class="token operator">||</span> postDateArg <span class="token operator">&amp;&amp;</span> date <span class="token operator">&gt;=</span> postDateArg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"/posts/"</span> <span class="token operator">+</span> slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fmData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token function">createPagesForPosts</span><span class="token punctuation">(</span>allPosts<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// tags code without changes</span>
<span class="token comment">//...</span>
</code></pre><p>If I run</p> <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run build -- --post-number<span class="token operator">=</span><span class="token number">8</span>
</code></pre><p>Routes for prerender plugin will be</p> <pre class="language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token string">'/posts/00008_javafx_custom_window.md'</span><span class="token punctuation">,</span>
  <span class="token string">'/page/1'</span><span class="token punctuation">,</span>
  <span class="token string">'/tag'</span><span class="token punctuation">,</span>
  <span class="token string">'/tag/java/'</span>
<span class="token punctuation">]</span>
</code></pre><h1>Conclusion</h1> <p><code>Vue.js</code> and <code>PrerenderSpaPlugin</code> are more better for me than <code>VuePress</code>. I have more freedom. I feel I can do with this configuration what I want. I like the ability to customize my blog.</p> <p>My customization gives me advantages:</p> <ul><li>wright order with pagination</li> <li>dehydrated pages</li> <li>build time</li> <li>partial build</li> <li>html as source for post</li></ul> <p>I shared the result of my experiments (<a href="https://github.com/Qwertovsky/vuejs-blog-generator">link</a>).</p></div></div></div></section><footer id="page-footer"><div class="line"><a href="//www.qwertovsky.com" class="footer_logo"><img src="/blog/img/largeqwerto.176d8a1e.svg"></a><div class="copyright">Qwertovsky</div><div class="spacer"></div><div class="links"><a href="https://twitter.com/qwertovsky" class="twitter"><svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="mailto:valery@qwertovsky.com" class="mail"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a></div></div></footer></div>
  
    


</body></html>