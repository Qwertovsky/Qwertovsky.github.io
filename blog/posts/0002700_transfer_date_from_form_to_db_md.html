<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/blog/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transfer date from form to database | Qwertoblog</title>

    <link rel="stylesheet" href="/blog/assets/index-dbbc22e1.css" />
  </head>
  <body>
    <div id="app" data-server-rendered="true">
      <div id="appWrap">
        <div id="pageHeader">
          <a href="/blog/" class="qm_brand">QwertoBlog</a>
          <div></div>
          <a href="/blog/tag" class="qm_nav_link tags_link" tabindex="0">Tags</a
          ><a class="qm_nav_link site_link" tabindex="0" href="//qwertovsky.com"
            >Site</a
          >
        </div>
        <section id="centerPart">
          <div class="post">
            <div class="post_title">
              <span>Transfer date from form to database</span>
            </div>
            <div class="post_meta">
              2021-01-05
              <span
                ><!--[--><span>
                  | <a href="/blog/tag/java" class="">java</a></span
                ><span> | <a href="/blog/tag/js" class="">js</a></span
                ><span>
                  | <a href="/blog/tag/frontend" class="">frontend</a></span
                ><span> | <a href="/blog/tag/backend" class="">backend</a></span
                ><span>
                  | <a href="/blog/tag/postgresql" class="">postgresql</a></span
                ><!--]--></span
              >
            </div>
            <div class="post_content">
              <div>
                <div>
                  <div>
                    <p>
                      There are Angular, PrimeNG, Spring Boot, JDBC, PostgreSQL
                    </p>
                    <p>
                      I need to save date and time from form to database and
                      show it again.
                    </p>
                    <!-- more -->
                    <h2>Prepare DB</h2>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> test_date<span class="token punctuation">;</span>
</code></pre>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_table <span class="token punctuation">(</span>
	test_date <span class="token keyword">date</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	test_timestamp <span class="token keyword">timestamp</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	test_timestamptz timestamptz <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	id serial2<span class="token punctuation">,</span>
	<span class="token keyword">CONSTRAINT</span> test_table_pk <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <h1>java.util.Date</h1>
                    <h2>Solution 1</h2>
                    <p>
                      I need just date without a time. I will use the column
                      with type <code>date</code>. Choose
                      <code>2020-12-22</code> on the form.
                      <code>2020-12-21T21:00:00.000Z</code> is sent. It is a
                      begining of day in UTC, because browser is in +3. Java
                      makes statement
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java">statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span>
</code></pre>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_date<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-22 +03'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      JDBC cuts the time out and adds time zone (by default
                      system zone or
                      <code>-Duser.timezone=Europe/Moscow</code>). Postgres
                      doesn't look at zone for column <code>date</code>.
                      <code>2020-12-22</code> is saved. Same is read from DB.
                      Result Json is
                    </p>
                    <pre
                      class="language-json"
                    ><code class="language-json"><span class="token punctuation">{</span> <span class="token property">"testDate"</span><span class="token operator">:</span> <span class="token string">"2020-12-22"</span> <span class="token punctuation">}</span>
</code></pre>
                    <p>Browser interprets this format as a day start in UTC.</p>
                    <pre
                      class="language-js"
                    ><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-12-22'</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-12-22T00:00:00.000+00:00'</span><span class="token punctuation">)</span>
Tue Dec <span class="token number">22</span> <span class="token number">2020</span> <span class="token number">03</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">0300</span> <span class="token punctuation">(</span>Moscow Standard Time<span class="token punctuation">)</span>
</code></pre>
                    <p>
                      I see on form <code>2020-12-22 03:00</code> or just
                      <code>2020-12-22</code> without a time. It is right.
                    </p>
                    <p>
                      I have faced a situation where Chrome and Firefox
                      interpreted a date without a time differently. Someone did
                      it as the beginning of the day in local time. This is not
                      currently reproduced on updated versions. The
                      documentation says that this format is now standardized.
                      But if the string differs from the format
                      <code>2020-12-22T00:00:00.000+00:00</code>, then the
                      behavior is not guaranteed.
                    </p>
                    <h3>Error</h3>
                    <p>
                      Error rises if there is user that is east of sever's time
                      zone. For example <code>Europe/Samara</code> (+4). He
                      choose <code>2020-12-22</code>. Browser sends
                      <code>2020-12-21T20:00:00.000Z</code> (<code
                        >2020-12-22 00:00 +4</code
                      >). Server (works in +3) translate it to
                      <code>2020-12-21T23:00:00.000+03:00</code>, cuts time out
                      and inserts it as
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_date<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21 +03'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      Then server returns <code>2020-12-21</code>. Browser makes
                      <code>2020-12-21 04:00</code>. User sees
                      <code>2020-12-21</code>. Error.
                    </p>
                    <h2>Solution 2</h2>
                    <p>
                      Specify the user's time zone, not the server's zone, when
                      saving to the database.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token class-name">String</span> userZoneId <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">getZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
statement<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>Date</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span>userZoneId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      I can get it as a separate parameter in the request. I can
                      do this in JavaScript.
                    </p>
                    <pre
                      class="language-js"
                    ><code class="language-js">Intl<span class="token punctuation">.</span><span class="token function">DateTimeFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolvedOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>timeZone<span class="token punctuation">;</span>
</code></pre>
                    <p>
                      I can try new API with polyfill:
                      <code>Temporal.now().timeZone().id</code>.
                    </p>
                    <p>Request:</p>
                    <pre
                      class="language-json"
                    ><code class="language-json"><span class="token punctuation">{</span><span class="token property">"testDate"</span><span class="token operator">:</span><span class="token string">"2020-12-21T20:00:00.000Z"</span><span class="token punctuation">,</span><span class="token property">"zoneId"</span><span class="token operator">:</span><span class="token string">"Europe/Samara"</span><span class="token punctuation">}</span>
</code></pre>
                    <p>Saving to DB:</p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_date<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-22 +04'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      Knowing the zone, the JDBC driver transformes
                      <code>2020-12-21T23:00:00.000+03:00</code> to
                      <code>2020-12-22T00:00:00.000+04:00</code>, and makes
                      <code>2020-12-22 +04</code>. When reading it turns to
                      <code>2020-12-22</code> -&gt;
                      <code>2020-12-22 04:00:00</code>.
                      <code>2020-12-22</code> is on the form. All right.
                    </p>
                    <h3>Error</h3>
                    <p>
                      Now let's test the situation where the user is west of
                      UTC. For example <code>America/Chicago</code> (-6). The
                      selected date <code>2020-12-22</code> saved well. When
                      reading, the server returns it back, but it turns into
                      <code>2020-12-21 18:00</code> in user's local time and is
                      displayed as<code> 2020-12-21</code>.
                    </p>
                    <h2>Solution 3</h2>
                    <p>
                      The server should return the date with the time
                      <code>2020-12-22T00:00:00.000</code> and without a zone,
                      then it will be converted by the browser to the beginning
                      of the day according to local time. For this I will make a
                      date serializer
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonGenerator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">JsonSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">SerializerProvider</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateSerializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">SimpleDateFormat</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd'T'HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">Date</span> value<span class="token punctuation">,</span> <span class="token class-name">JsonGenerator</span> gen<span class="token punctuation">,</span> <span class="token class-name">SerializerProvider</span> serializers<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		gen<span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                    <p>
                      Now it is all right. The selected date is saved in the DB
                      correctly. And it returns back. Tested on different time
                      zones. Ready for prod.
                    </p>
                    <h3>Error</h3>
                    <p>
                      There will be bug on prod. User may see wrong date. It is
                      not a day before or a day after, it is another user's
                      date.
                    </p>
                    <h2>Solution 4</h2>
                    <p>
                      <code>java.text.SimpleDateFormat.format()</code> is not
                      thread safe. But I created it once for the whole
                      application. I must create new instance for each
                      serialization.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd'T'HH:mm:ss"</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">Date</span> value<span class="token punctuation">,</span> <span class="token class-name">JsonGenerator</span> gen<span class="token punctuation">,</span> <span class="token class-name">SerializerProvider</span> serializers<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  gen<span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                    <p>
                      The result is a service with a strange interface for
                      saving the date. In another client, I have to transfer not
                      only the date, but also calculate the time and transfer
                      the zone for which this time is calculated. If I want to
                      save <code>2020-12-22</code>, then I must first decide on
                      the zone. If it is +3, then I need to transfer
                    </p>
                    <pre
                      class="language-json"
                    ><code class="language-json"><span class="token punctuation">{</span><span class="token property">"testDate"</span><span class="token operator">:</span><span class="token string">"2020-12-21T21:00:00.000Z"</span><span class="token punctuation">,</span><span class="token property">"zoneId"</span><span class="token operator">:</span><span class="token string">"Europe/Moscow"</span><span class="token punctuation">}</span>
</code></pre>
                    <p>or</p>
                    <pre
                      class="language-json"
                    ><code class="language-json"><span class="token punctuation">{</span><span class="token property">"testDate"</span><span class="token operator">:</span><span class="token string">"2020-12-22T00:00:00.000+03:00"</span><span class="token punctuation">,</span><span class="token property">"zoneId"</span><span class="token operator">:</span><span class="token string">"Europe/Moscow"</span><span class="token punctuation">}</span>
</code></pre>
                    <p>
                      In the last one there is the duplication of necessary
                      information about the offset. I should remove
                      <code>zoneId</code> and leave the date in the format
                      <code>2020-12-22</code>. If request contains
                      <code>2020-12-21T21:00:00.000Z</code>, then ignore a time
                      and a zone parts - save it as <code>2020-12-21</code>).
                      The result should be returned without time too.
                    </p>
                    <h2>Solution 5</h2>
                    <p>
                      I remove my serializer from java. At the front, it is
                      necessary to process <code>2020-12-22</code> as the
                      beginning of the day according the local time.
                    </p>
                    <pre
                      class="language-ts"
                    ><code class="language-ts"><span class="token keyword">const</span> ymd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span>testDate<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> date<span class="token operator">:</span> Date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>ymd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      It is convenient and works in Chrome and Firefox. But the
                      constructor with the <code>Array</code> parameter is not
                      described in the standard. Therefore, the parameter is
                      converted to a string and passed to
                      <code>Date.parse()</code>. But this method works by
                      default only for <code>2020-12-22</code>. So, I write code
                      to make string according to the standard.
                    </p>
                    <pre
                      class="language-ts"
                    ><code class="language-ts"><span class="token keyword">const</span> ymd<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span>testDate<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> date<span class="token operator">:</span> Date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>ymd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ymd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> ymd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      The next step is to discard time when saving. JDBC already
                      does this. But this causes error for east users. Because
                      the time is discarded from the instant by server time. So,
                      the time must be cuted off before converting the string to
                      a date according to server time. Another problem appears
                      here: the browser sends the date as the beginning of the
                      day in UTC time. That is, the code must be written on the
                      front before sending it to the server.
                    </p>
                    <pre
                      class="language-ts"
                    ><code class="language-ts"><span class="token keyword">public</span> <span class="token function">saveEntity</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> TestEntity<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date<span class="token operator">:</span> Date <span class="token operator">=</span> entity<span class="token punctuation">.</span>testDate<span class="token punctuation">;</span>
	<span class="token keyword">const</span> testDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token punctuation">[</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> body<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token punctuation">{</span>testDate<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token constant">CONTROLLER</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                    <p>
                      This solution works, it works for users from all zones.
                      And I don't need to program anything on the server.
                    </p>
                    <h3>Error</h3>
                    <p>
                      Then a developer from Chicago appears on the project. And
                      he tests the application on his computer.
                      <code>2020-12-22</code> is sent to the server. The server
                      turns this into <code>2020-12-21 18:00:00</code>. And
                      saves as
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_date<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21 -06'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>Bug. Solution works only on a server east of UTC.</p>
                    <h2>Solution 6</h2>
                    <p>The simplest solution is to hardcode time zone.</p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"user.timezone"</span><span class="token punctuation">,</span> <span class="token string">"UTC"</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      But it is not entirely correct. What if the application
                      already has a lot of logic depending on the fact that the
                      server is located somewhere in the local time in the west?
                      The problem is that Jackson treats the received date as
                      the start of the day in UTC. I want the date to be the
                      start of the day for the server, so I have to hardcode
                      that zone and tell Jackson to use the server's zone for
                      conversion.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDateApplication</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">APP_TIMEZONE</span> <span class="token operator">=</span> <span class="token string">"America/Chicago"</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"user.timezone"</span><span class="token punctuation">,</span> <span class="token constant">APP_TIMEZONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TestDateApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonFormat</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestEntity</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>timezone <span class="token operator">=</span> <span class="token class-name">TestDateApplication</span><span class="token punctuation">.</span><span class="token constant">APP_TIMEZONE</span><span class="token punctuation">,</span> pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">Date</span> testDate<span class="token punctuation">;</span>
</code></pre>
                    <p>
                      Since the browser now send the date without a time, I can
                      restrict the interface and not allow the format with time.
                      If someone starts sending the time, then an error with the
                      time zones is possible.
                    </p>
                    <h2>Solution 7</h2>
                    <p>
                      Jackson skips dates like this by not counting the time.
                      Therefore, I need to write my own deserializer. It throws
                      an exception if the string is longer than the specified
                      format.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">ParseException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonProcessingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonToken</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">DeserializationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">JsonDeserializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>exc<span class="token punctuation">.</span></span><span class="token class-name">InvalidFormatException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateDeserializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonDeserializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">JsonParser</span> p<span class="token punctuation">,</span> <span class="token class-name">DeserializationContext</span> ctxt<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">hasToken</span><span class="token punctuation">(</span><span class="token class-name">JsonToken</span><span class="token punctuation">.</span><span class="token constant">VALUE_STRING</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> text <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> format<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidFormatException</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">"Wrong date"</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidFormatException</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">"Wrong date"</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> ctxt<span class="token punctuation">.</span><span class="token function">handleUnexpectedToken</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                    <p>
                      If I save the date in the east and open it in the west,
                      then this date is the same. But in the west it may be only
                      yesterday. This may be a mistake, depends on the task. If
                      we are talking about the date of birth, then there is no
                      mistake. If about the publication date of the news, then
                      the reader in the west may see news from the future. It
                      might look strange.
                    </p>
                    <h2>Solution 8</h2>
                    <p>
                      For such a case, I have to store the time along with the
                      date. It depends on whether the day is the same for two
                      time zones at this time or is different. Two types can be
                      used for DB column: <code>timestamp</code> or
                      <code>timestamp with time zone</code>. It seems, I don't
                      need to store the zone, so I will use a
                      <code>timestamp</code>.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLUMN_LABEL</span> <span class="token operator">=</span> <span class="token string">"test_timestamp"</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

statement<span class="token punctuation">.</span><span class="token function">setTimestamp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Timestamp</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      The date <code>2020-12-21T20:00:00.000Z</code> come from
                      front. It is transferred to the base as
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_timestamptz<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21 14:00:00-06'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      And is saved as <code>2020-12-21 14:00:00</code>. Time
                      <code>2020-12-21T20:00:00.000+00:00</code> returns to
                      front and user see local time. It works.
                    </p>
                    <h3>Error</h3>
                    <p>
                      There is error, if server's time zone changes. The time in
                      DB is time in server's zone. Another server in different
                      time zone reads wrong time. Time
                      <code>2020-12-21 14:00:00</code> on
                      <code>Europe/Moscow</code> server becomes
                      <code>2020-12-21T11:00:00.000+00:00</code>. Should be
                      <code>2020-12-21T20:00:00.000+00:00</code>.
                    </p>
                    <h2>Solution 9</h2>
                    <p>
                      The server must always be in the same zone. Or it is
                      necessary to store dates in one zone and indicate it
                      explicitly. Since the server was previously in
                      <code>America/Chicago</code> and the time is stored in
                      such a zone, I will hard code this zone
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLUMN_TIMEZONE</span> <span class="token operator">=</span> <span class="token string">"America/Chicago"</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">,</span>
        <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span><span class="token constant">COLUMN_TIMEZONE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

statement<span class="token punctuation">.</span><span class="token function">setTimestamp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Timestamp</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span><span class="token constant">COLUMN_TIMEZONE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      To make it easier to debug, it is better to make the zone
                      <code>UTC</code>. And I convert the time to
                      <code>UTC</code> in the database.
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">update</span> test_table
<span class="token keyword">set</span> test_timestamp <span class="token operator">=</span>
    <span class="token punctuation">(</span>test_timestamp at <span class="token keyword">time</span> zone <span class="token string">'America/Chicago'</span><span class="token punctuation">)</span> at <span class="token keyword">time</span> zone <span class="token string">'UTC'</span><span class="token punctuation">;</span>
</code></pre>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLUMN_TIMEZONE</span> <span class="token operator">=</span> <span class="token string">"UTC"</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      <code>2020-12-21T20:00:00.000Z</code> is come from front.
                      Server sends to DB
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_timestamp<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21 20:00:00+00'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      It is stored as <code>2020-12-21 20:00:00</code>. It will
                      be readed as <code>2020-12-21 14:00:00</code> on server
                      (-6). <code>2020-12-21T20:00:00.000+00:00</code> returns
                      on front. It contains time zone and is shown on the form
                      as local time.
                    </p>
                    <h2>Solution 10</h2>
                    <p>
                      It turned out the same thing that could be done right away
                      using <code>timestamp with time zone</code>. This type
                      does not store a zone. It stores the time for the UTC zone
                      and automatically converts it to the time for the other
                      zone. So, the code can be rewritten without specifying the
                      zone when saving and reading.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLUMN_LABEL</span> <span class="token operator">=</span> <span class="token string">"test_timestamptz"</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

statement<span class="token punctuation">.</span><span class="token function">setTimestamp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Timestamp</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      <code>2020-12-21T20:00:00.000Z</code> comes from front. It
                      is sent to DB as
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_timestamptz<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21 14:00:00-06'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      <code>-06</code> is because of java server timezone. And
                      it is saved in the database regardless of the postgresql
                      zone as the time <code>2020-12-21T20:00:00.000Z</code>.
                      When reading, the server receives
                      <code>2020-12-21 14:00:00</code> according to java server
                      timezone. The time comes to the front with the indication
                      of the zone <code>2020-12-21T20:00:00.000+00:00</code> and
                      the local time is shown.
                    </p>
                    <h2>Solution 11</h2>
                    <p>
                      I need the time is always shown what was selected on the
                      form, and does not depend on the time zone of the browser
                      or server.<br />
                      For network transmission I use the format without
                      specifying the zone. For storage I use the
                      <code>timestamp</code> column.
                    </p>
                    <pre
                      class="language-ts"
                    ><code class="language-ts"><span class="token keyword">public</span> <span class="token function">saveEntity</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> TestEntity<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> date<span class="token operator">:</span> Date <span class="token operator">=</span> entity<span class="token punctuation">.</span>testDate<span class="token punctuation">;</span>
	<span class="token keyword">const</span> testDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token punctuation">[</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
		<span class="token operator">+</span> <span class="token string">'T'</span> <span class="token operator">+</span> <span class="token punctuation">[</span>date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> body<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token punctuation">{</span>testDate<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token constant">CONTROLLER</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token annotation punctuation">@JsonDeserialize</span><span class="token punctuation">(</span>using <span class="token operator">=</span> <span class="token class-name">DateDeserializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd'T'HH:mm:ss"</span><span class="token punctuation">,</span>
  timezone <span class="token operator">=</span> <span class="token class-name">TestDateApplication</span><span class="token punctuation">.</span><span class="token constant">APP_TIMEZONE</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> testDate<span class="token punctuation">;</span>
</code></pre>
                    <p>In deserializer:</p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token class-name">Date</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd'T'HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      I choose <code>2020-12-22 14:14</code> on the form.
                      <code>2020-12-22T14:14:00</code> is sent. This format is
                      translated as server local time. The same is sent to DB.
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_timestamp<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-22 14:14:00+04'</span><span class="token punctuation">)</span>
</code></pre>
                    <p>
                      Since the column type is
                      <code>timestamp without time zone</code>, the transferred
                      zone is discarded, and there is no additional conversion.
                      When reading, everything is the same.
                    </p>
                    <pre
                      class="language-js"
                    ><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-12-22T14:14:00'</span><span class="token punctuation">)</span>
Tue Dec <span class="token number">22</span> <span class="token number">2020</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">GMT</span><span class="token operator">-</span><span class="token number">0600</span> <span class="token punctuation">(</span>Central Standard Time<span class="token punctuation">)</span>
</code></pre>
                    <p>Browser displays what was saved in any time zone.</p>
                    <h1>Time API</h1>
                    <h2>Solution 1</h2>
                    <p>
                      I need just date without time. Column type -
                      <code>date</code>. DTO field type -
                      <code>LocalDate</code>.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">LocalDate</span> testDate<span class="token punctuation">;</span>

statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"test_date"</span><span class="token punctuation">,</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      Choose <code>2020-12-22</code>. Browser sends
                      <code>2020-12-21T21:00:00.000Z</code>. Jackson translates
                      it to <code>LocalDateTime</code> for zone
                      <code>UTC</code> and cuts time off.
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_date<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21'</span>::<span class="token keyword">date</span><span class="token punctuation">)</span>
</code></pre>
                    <p>Date <code>2020-12-21</code> returns back.</p>
                    <pre
                      class="language-js"
                    ><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-12-21'</span><span class="token punctuation">)</span>
Mon Dec <span class="token number">21</span> <span class="token number">2020</span> <span class="token number">03</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">0300</span> <span class="token punctuation">(</span>Moscow Standard Time<span class="token punctuation">)</span>
</code></pre>
                    <p>Wrong.</p>
                    <h2>Solution 2</h2>
                    <p>I need to deserialize with server's time zone.</p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">LocalDate</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">JsonParser</span> p<span class="token punctuation">,</span> <span class="token class-name">DeserializationContext</span> ctxt<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">hasToken</span><span class="token punctuation">(</span><span class="token class-name">JsonToken</span><span class="token punctuation">.</span><span class="token constant">VALUE_STRING</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">DateTimeFormatter</span> formatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTimeFormatterBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token constant">ISO_LOCAL_DATE_TIME</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">appendZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">toFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">LocalDate</span> result <span class="token operator">=</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> formatter<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withZoneSameInstant</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidFormatException</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">"Wrong date"</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">)</span> ctxt<span class="token punctuation">.</span><span class="token function">handleUnexpectedToken</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                    <p>Now DB gets the right date.</p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_date<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-22'</span>::<span class="token keyword">date</span><span class="token punctuation">)</span>
</code></pre>
                    <p>But this doesn't work for user east of the server.</p>
                    <h2>Solution 3</h2>
                    <p>
                      I can solve this by transferring the user's zone. So I
                      need to change the field type to the type with time:
                      <code>LocalDateTime</code>.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token class-name">String</span> zoneId <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">getZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withZoneSameInstant</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>zoneId<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <pre
                      class="language-java"
                    ><code class="language-java">entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>
		<span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MIN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      The date is returned from the server with the time:
                      <code>2021-12-22T00:00:00</code>. Therefore, this solution
                      will work for users from west as well.
                    </p>
                    <h2>Solution 4</h2>
                    <p>
                      If I form a date without time on the front, then on the
                      server I can leave only a field with the
                      <code>LocalDate</code> type. And there are no more
                      additional conversions.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java">statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      This solution works, even I move the server to another
                      time zone.
                    </p>
                    <p>
                      To prevent the error from transferring the date in ISO
                      format with time, it is enough to specify the format.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">LocalDate</span> testDate<span class="token punctuation">;</span>
</code></pre>
                    <p>Jackson throws an exception at additional characters.</p>
                    <h2>Solution 5</h2>
                    <p>
                      I can use <code>LocalDateTime</code> to save time. But to
                      convert the string
                      <code>2020-12-21T20:00:00.000Z</code> to local time, I
                      need a deserializer using <code>ZoneDateTime</code>. So I
                      will use this type for field.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java">statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>
    entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withZoneSameInstant</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>
    <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
        rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      But if I change server's time zone, all saved dates is
                      broken.
                    </p>
                    <h2>Solution 6</h2>
                    <p>I hard code time zone to save date in DB.</p>
                    <pre
                      class="language-java"
                    ><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLUMN_TIMEZONE</span> <span class="token operator">=</span> <span class="token string">"UTC"</span><span class="token punctuation">;</span>

statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>
    entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withZoneSameInstant</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">COLUMN_TIMEZONE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">toLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>
    <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
        rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">COLUMN_TIMEZONE</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <h2>Solution 7</h2>
                    <p>
                      Now I can switch to the column type
                      <code>timestamptz</code>. To insert
                      <code>ZonedDateTime</code> in such column, I can use
                      <code>LocalDateTime</code>. But I must to convert the time
                      to the server's time zone.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java">statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>
    entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withZoneSameInstant</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">toLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      Because JDBC adds an offset based on the server's zone to
                      the request. Postgres uses this offset for conversion to
                      UTC.
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_timestamptz<span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21 23:30:00+03'</span>::<span class="token keyword">timestamp</span><span class="token punctuation">)</span>
</code></pre>
                    <p>I can use <code>OffsetDateTime</code>.</p>
                    <pre
                      class="language-java"
                    ><code class="language-java">statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toOffsetDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      Then what came from the browser will be transferred to DB.
                    </p>
                    <pre
                      class="language-sql"
                    ><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> test_table <span class="token punctuation">(</span>test_timestamptz<span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'2020-12-21 20:30:00+00'</span>::<span class="token keyword">timestamp</span> <span class="token keyword">with</span> <span class="token keyword">time</span> zone<span class="token punctuation">)</span>
</code></pre>
                    <p>
                      JDBC can read only <code>OffsetDateTime</code> from
                      <code>timestamptz</code>.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java">entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>
    rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">OffsetDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toZonedDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      So I change the DTO field to <code>OffsetDateTime</code>.
                    </p>
                    <h2>Solution 8</h2>
                    <p>
                      To save the selected time and display it regardless of the
                      browser zone or server zone, it is enough to send the
                      local time without zone.
                    </p>
                    <pre
                      class="language-ts"
                    ><code class="language-ts"><span class="token keyword">public</span> <span class="token function">saveEntity</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> TestEntity<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> date<span class="token operator">:</span> Date <span class="token operator">=</span> entity<span class="token punctuation">.</span>testDate<span class="token punctuation">;</span>
	<span class="token keyword">const</span> testDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token punctuation">[</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
		<span class="token operator">+</span> <span class="token string">'T'</span> <span class="token operator">+</span> <span class="token punctuation">[</span>date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> body<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token punctuation">{</span>testDate<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token constant">CONTROLLER</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                    <p>
                      I use <code>LocalDateTime</code> and
                      <code>timestamp</code>.
                    </p>
                    <pre
                      class="language-java"
                    ><code class="language-java">statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">getTestDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setTestDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token constant">COLUMN_LABEL</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                    <p>
                      No additional Jackson setup is needed. When transferring
                      time with the zone, Jackson throws error.
                    </p>
                    <h1>Conclusion</h1>
                    <p>
                      To avoid some mistakes, I should make some setup from
                      start: the date format in request and response, the zone
                      in which the Java server works, the time zone in which the
                      time is stored in DB.
                    </p>
                    <p>
                      Additional errors may appear due to outdated tzdata.
                      PostgreSQL has its own tzdata. If there are columns
                      <code>timestamptz</code>, then tzdata is used. Minor
                      releases need to be tracked. If Postgres is compiled with
                      the <code>with-system-tzdata</code> flag, then I need to
                      update the system tzdata. Java has its own tzdata. I need
                      to update it too. Update can be made apart from full jre
                      update. Joda-time has its own tzdata.
                    </p>
                    <p>
                      All solutions are available in repository
                      <a href="https://github.com/Qwertovsky/test_date/commits/"
                        >https://github.com/Qwertovsky/test_date</a
                      >.
                    </p>
                  </div>
                </div>
              </div>
              <!---->
            </div>
          </div>
        </section>
        <footer id="page-footer">
          <div class="line">
            <a class="footer_logo" href="//www.qwertovsky.com"
              ><img src="/blog/assets/largeqwerto-12cd7be1.svg"
            /></a>
            <div class="copyright">Qwertovsky</div>
            <div class="spacer"></div>
            <div class="links">
              <a class="twitter" href="https://twitter.com/qwertovsky"
                ><svg
                  aria-hidden="true"
                  focusable="false"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                  class=""
                >
                  <path
                    d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"
                    class=""
                  ></path></svg></a
              ><a class="mail" href="mailto:g7opj79577vmd3ds@fastmail.com"
                ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <path
                    d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"
                  ></path></svg
              ></a>
            </div>
          </div>
        </footer>
      </div>
    </div>
  </body>
</html>
